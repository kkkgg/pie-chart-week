<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>曜日ようび</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto,
                Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue',
                sans-serif;
            display: grid;
            place-items: center;
            min-height: 95vh;
            background-color: #f0f2f5;
            color: #333;
        }

        h1 {
            font-weight: 300;
            color: #555;
        }

        .chart-container {
            width: 90vw;
            max-width: 400px;
            position: relative;
        }

        #pie-chart {
            width: 100%;
            height: 100%;
            /* 今日のピースが拡大したときに見切れないように */
            overflow: visible; 
        }

        /* 各曜日のグループ */
        .day-group {
            cursor: pointer;
            transition: transform 0.3s ease, filter 0.3s ease;
        }

        /* 曜日のピース（扇形） */
        .day-slice {
            stroke: rgba(255, 255, 255, 0.5); /* ピース間の境界線 */
            stroke-width: 0.5;
        }

        /* ホバー時 */
        .day-group:not(.today):hover {
            transform: scale(1.02);
            filter: brightness(1.1);
        }

        /* 曜日のテキスト */
        .day-text {
            font-size: 8px;
            font-weight: bold;
            fill: rgba(0, 0, 0, 0.7);
            text-anchor: middle; /* 水平中央揃え */
            dominant-baseline: middle; /* 垂直中央揃え */
            pointer-events: none; /* テキストがクリックイベントを邪魔しないように */
        }

        /* --- 今日の曜日のハイライト --- */
        .day-group.today {
            /* 他のピースより手前に表示 */
            transform: scale(1.08);
            z-index: 10;
        }

        .day-group.today .day-slice {
            /* 影をつけて目立たせる */
            filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.3));
            /* 枠線を太くする */
            stroke: #ffffff;
            stroke-width: 1.5;
        }

        .day-group.today .day-text {
            fill: #000;
            font-size: 9px;
        }
    </style>
</head>
<body>
    <h1>曜日ようび</h1>

    <div class="chart-container">
        <svg id="pie-chart" viewBox="0 0 100 100"></svg>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const svgNS = 'http://www.w3.org/2000/svg';
            const pie = document.getElementById('pie-chart');
            const R = 48; // 半径 (ViewBox 100 の中心 50 に対して)
            const CX = 50;
            const CY = 50;
            const sliceAngle = 360 / 7;
            
            // 日曜日を真上に配置するために開始角度を調整 (-90度が真上)
            const startAngle = -90 - sliceAngle / 2;

            // 曜日データ (JavaScriptの getDay() の順序: 0=日, 1=月, ...)
            const days = [
                { name: '🌞日', color: '#FF9800', reading: 'にちようび' }, // 0: 太陽 (オレンジ)
                { name: '🌛月🏫', color: '#FFEB3B', reading: 'げつようび' }, // 1: 月 (黄)
                { name: '🔥火🏫', color: '#F44336', reading: 'かようび' },   // 2: 火 (赤)
                { name: '💧水🏫', color: '#2196F3', reading: 'すいようび' }, // 3: 水 (青)
                { name: '🌳木🏫', color: '#4CAF50', reading: 'もくようび' }, // 4: 木 (緑)
                { name: '💰金🏫🐶', color: '#FFC107', reading: 'きんようび' }, // 5: 金 (ゴールド)
                { name: '⛰️土', color: '#795548', reading: 'どようび' }    // 6: 土 (茶)
            ];

            // 角度をラジアンに変換するヘルパー関数
            const degToRad = (deg) => deg * (Math.PI / 180);

            // 座標を計算するヘルパー関数
            const getCoords = (angle) => {
                const rad = degToRad(angle);
                return {
                    x: CX + R * Math.cos(rad),
                    y: CY + R * Math.sin(rad),
                };
            };

            // 1. 各曜日のピース（SVG要素）を生成
            days.forEach((day, index) => {
                const angle1 = startAngle + sliceAngle * index;
                const angle2 = startAngle + sliceAngle * (index + 1);

                const p1 = getCoords(angle1);
                const p2 = getCoords(angle2);

                // SVGのパスデータ (M 中心 L 開始点 A 円弧 Z 閉じる)
                // A ${R},${R} 0 0,1 ${p2.x},${p2.y}
                // (R,R: 半径, 0: 回転, 0: large-arc-flag, 1: sweep-flag)
                const d = `M ${CX},${CY} L ${p1.x},${p1.y} A ${R},${R} 0 0,1 ${p2.x},${p2.y} Z`;

                const path = document.createElementNS(svgNS, 'path');
                path.setAttribute('d', d);
                path.setAttribute('fill', day.color);
                path.classList.add('day-slice');

                // テキストの位置（各ピースの中央）
                const textAngle = angle1 + sliceAngle / 2;
                const textR = R * 0.7; // テキストを中心から70%の位置に
                const textRad = degToRad(textAngle);
                const tx = CX + textR * Math.cos(textRad);
                const ty = CY + textR * Math.sin(textRad);

                const text = document.createElementNS(svgNS, 'text');
                text.setAttribute('x', tx);
                text.setAttribute('y', ty);
                text.textContent = day.name;
                text.classList.add('day-text');

                // グループ化 (クリックイベントとスタイリングのため)
                const group = document.createElementNS(svgNS, 'g');
                group.setAttribute('id', `day-${index}`);
                group.dataset.reading = day.reading; // 音声再生用のデータを保持
                group.classList.add('day-group');

                group.appendChild(path);
                group.appendChild(text);

                // 2. 音声再生のクリックイベントを追加
                group.addEventListener('click', () => {
                    playSpeech(day.reading);
                });

                pie.appendChild(group);
            });

            // 3. 今日の曜日をハイライトする関数
            const updateHighlight = () => {
                const todayIndex = new Date().getDay(); // 0=日, 1=月, ...

                // すべてのハイライトを一旦解除
                document.querySelectorAll('.day-group.today').forEach((el) => {
                    el.classList.remove('today');
                });

                // 今日の曜日に 'today' クラスを追加
                const todayElement = document.getElementById(`day-${todayIndex}`);
                if (todayElement) {
                    todayElement.classList.add('today');
                }
            };

            // 4. 音声再生関数 (Web Speech API)
            const playSpeech = (text) => {
                // ブラウザが音声合成に対応しているかチェック
                if (!window.speechSynthesis) {
                    alert('お使いのブラウザは音声合成に対応していません。');
                    return;
                }
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'ja-JP'; // 日本語に設定
                utterance.rate = 1.0; // 読み上げ速度
                speechSynthesis.speak(utterance);
            };

            // 5. リアルタイム更新処理
            // ページ読み込み時に初回実行
            updateHighlight();

            // その後、1分ごとに日付が変わっていないかチェック
            setInterval(updateHighlight, 60000); 
        });
    </script>
</body>
</html>